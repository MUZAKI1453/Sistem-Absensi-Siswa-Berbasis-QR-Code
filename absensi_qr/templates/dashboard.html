{% extends "base.html" %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4 text-center fw-bold text-dark">Dashboard Absensi</h2>

    <div class="row g-4 justify-content-center">
        <div class="col-12 col-md-5">
            <div class="card shadow-lg rounded-4 border-0 mb-4 bg-dark text-white">
                <div class="card-body d-flex flex-column justify-content-center align-items-center p-4">
                    <div id="digital-clock" class="fw-bold display-4"></div>
                    <p class="mt-2 mb-0" id="current-date-time"></p>
                </div>
            </div>

            <h5 class="mt-4 mb-3 text-center fw-bold text-dark">Laporan Hari Ini</h5>
            <div class="row g-3 text-center">
                <div class="col-6 col-md-4">
                    <div class="card h-100 shadow rounded-4 border-0">
                        <div class="card-body p-3 bg-success text-white rounded-4 d-flex flex-column align-items-center">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <h4 class="card-title fw-bold mb-0">{{ total_hadir }}</h4>
                            <p class="card-text mt-1">Hadir</p>
                        </div>
                    </div>
                </div>

                <div class="col-6 col-md-4">
                    <div class="card h-100 shadow rounded-4 border-0">
                        <div class="card-body p-3 bg-warning text-dark rounded-4 d-flex flex-column align-items-center">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <h4 class="card-title fw-bold mb-0">{{ total_terlambat }}</h4>
                            <p class="card-text mt-1">Terlambat</p>
                        </div>
                    </div>
                </div>

                <div class="col-6 col-md-4">
                    <div class="card h-100 shadow rounded-4 border-0">
                        <div class="card-body p-3 bg-info text-white rounded-4 d-flex flex-column align-items-center">
                            <i class="fas fa-bed fa-2x mb-2"></i>
                            <h4 class="card-title fw-bold mb-0">{{ total_sakit }}</h4>
                            <p class="card-text mt-1">Sakit</p>
                        </div>
                    </div>
                </div>

                <div class="col-6 col-md-4">
                    <div class="card h-100 shadow rounded-4 border-0">
                        <div class="card-body p-3 bg-primary text-white rounded-4 d-flex flex-column align-items-center">
                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                            <h4 class="card-title fw-bold mb-0">{{ total_izin }}</h4>
                            <p class="card-text mt-1">Izin</p>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-4">
                    <div class="card h-100 shadow rounded-4 border-0">
                        <div class="card-body p-3 bg-danger text-white rounded-4 d-flex flex-column align-items-center">
                            <i class="fas fa-times-circle fa-2x mb-2"></i>
                            <h4 class="card-title fw-bold mb-0">{{ total_alfa }}</h4>
                            <p class="card-text mt-1">Alfa</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-md-7">
            <div class="card shadow-lg rounded-4 border-0 mb-4 p-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <button id="prev-month" class="btn btn-sm btn-outline-secondary rounded-pill">&lt;</button>
                    <h5 id="current-month-year" class="card-title mb-0 text-center fw-bold"></h5>
                    <button id="next-month" class="btn btn-sm btn-outline-secondary rounded-pill">&gt;</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-borderless text-center mb-0">
                        <thead class="fw-bold">
                            <tr>
                                <th>Sen</th>
                                <th>Sel</th>
                                <th>Rab</th>
                                <th>Kam</th>
                                <th>Jum</th>
                                <th>Sab</th>
                                <th>Min</th>
                            </tr>
                        </thead>
                        <tbody id="calendar-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="row g-3 text-center">
                <div class="col-6">
                    <div class="card h-100 shadow-lg rounded-4 overflow-hidden border-0 bg-primary text-white">
                        <div class="card-body d-flex flex-column align-items-center p-4">
                            <h4 class="card-title fw-bold display-5 mb-0">{{ total_siswa }}</h4>
                            <p class="card-text text-uppercase fw-semibold mt-2">Total Siswa</p>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card h-100 shadow-lg rounded-4 overflow-hidden border-0 bg-secondary text-white">
                        <div class="card-body d-flex flex-column align-items-center p-4">
                            <h4 class="card-title fw-bold display-5 mb-0">{{ total_kelas }}</h4>
                            <p class="card-text text-uppercase fw-semibold mt-2">Total Kelas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" xintegrity="sha512-1ycn6IcaQQ40B7M1aG5G2Fz2eA9vT6Jt5tY2jU40s2g6T5hI5S5M4kF4f5eE6r8P8W8K9p6U7jL2v1T5z0T9g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const calendarBody = document.getElementById('calendar-body');
        const currentMonthYear = document.getElementById('current-month-year');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const digitalClock = document.getElementById('digital-clock');
        const currentDateTime = document.getElementById('current-date-time');

        const today = new Date();
        let currentDate = new Date();

        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            digitalClock.textContent = `${hours}:${minutes}:${seconds}`;

            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            currentDateTime.textContent = now.toLocaleDateString('id-ID', options);
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            currentMonthYear.textContent = `${currentDate.toLocaleString('id-ID', { month: 'long' })} ${year}`;
            calendarBody.innerHTML = '';

            let date = 1;
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    cell.classList.add('px-1', 'py-1');

                    const firstDayAdjusted = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;

                    if (i === 0 && j < firstDayAdjusted) {
                        const prevMonthDaysInMonth = new Date(year, month, 0).getDate();
                        cell.textContent = prevMonthDaysInMonth - firstDayAdjusted + j + 1;
                        cell.classList.add('text-muted');
                    } else if (date > daysInMonth) {
                        const nextMonthDate = date - daysInMonth;
                        cell.textContent = nextMonthDate;
                        date++;
                        cell.classList.add('text-muted');
                    } else {
                        cell.textContent = date;
                        if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === date) {
                            cell.classList.add('rounded-circle', 'fw-bold', 'bg-primary', 'text-white');
                        }
                        date++;
                    }
                    row.appendChild(cell);
                }
                calendarBody.appendChild(row);
                if (date > daysInMonth) {
                    break;
                }
            }
        }

        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        updateClock();
        setInterval(updateClock, 1000);
        renderCalendar();
    });
</script>
{% endblock %}